<div ng-if="!$ctrl.initialized">
  <div class="container">
    <div class="row">
  <div class="col-md-12">
  <div class="cds-deposit-box cds-deposit-box-upload-intro">
    <ul class="nav nav-pills cds-pills-center" ng-init="active_uploader='local'">
      <li ng-class="{active: active_uploader=='local'}"><a ng-click="active_uploader='local'" role="tab" data-toggle="tab">Upload local files</a></li>
      <li ng-class="{active: active_uploader=='remote'}"><a ng-click="active_uploader='remote'" role="tab" data-toggle="tab">Upload by URL</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane" ng-class="{active: active_uploader=='local'}">
        <div
             ngf-drag-over-class="'dragover'"
             ngf-drop=""
             ngf-change="$ctrl.addFiles($newFiles)"
             ngf-select=""
             ngf-max-size="20GB"
             ngf-multiple="true"
        >
          <div class="cds-deposit-box-upload-wrapper text-center">
            <p class="cds-deposit-box-upload-icon">
              <i class="fa fa-3x fa-cloud-upload" aria-hidden="true"></i>
            </p>
            <div class="cds-deposit-box-upload-content">
              <div class="cds-deposit-box-upload-title">
                <h4>Select files to upload</h4>
              </div>
              <p class="cds-deposit-box-upload-description"> Or drag and drop video files</p>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane" ng-class="{active: active_uploader=='remote'}">
        <cds-remote-uploader
            template="/static/templates/cds_deposit/remote_upload.html"
            dropbox-enabled="true"
            dropbox-selector=".dropbox-upload"
            dropbox-app-key="{{ dropboxAppKey }}"
            remote-master-receiver="/api/hooks/receivers/avc/events/"
            remote-children-receiver="/api/hooks/receivers/downloader/events/"
        >
          <div class="dropbox-upload"></div>
        </cds-remote-uploader>
      </div>
    </div>
  </div>
</div>
</div>
</div>
</div>

<div ng-if="$ctrl.initialized">
    <cds-deposit
      master="true"
      id="$ctrl.master.metadata._deposit.id"
      links="$ctrl.master.links"
      update-record-after-success="true"
      schema="{{ $ctrl.masterSchema }}"
      record="$ctrl.master.metadata"
      deposit-form-model="$ctrl.depositForms[0]"
    >
    <div set-class-when-at-top="status-fix-top" class="cds-deposit-avc-overall-status mb-20 mt--20">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <ul class="list-inline text-left">
              <li>
                <i class="fa fa-fw {{ $ctrl.aggregatedState['file_download'] | progressIcon }} {{ $ctrl.aggregatedState['file_download'] | progressClass }}"></i> File download
              </li>
              <li>
                <i class="fa fa-fw {{ $ctrl.aggregatedState['file_video_metadata_extraction'] | progressIcon }} {{ $ctrl.aggregatedState['file_video_metadata_extraction'] | progressClass }}"></i> Extract metadata
              </li>
              <li>
                <i class="fa fa-fw {{ $ctrl.aggregatedState['file_video_extract_frames'] | progressIcon }} {{ $ctrl.aggregatedState['file_video_extract_frames'] | progressClass }}"></i> Extract frames
              </li>
              <li>
                <i class="fa fa-fw {{ $ctrl.aggregatedState['file_transcode'] | progressIcon}} {{ $ctrl.aggregatedState['file_transcode'] | progressClass}}"></i> File transcode
              </li>
            </ul>
          </div>
          <div class="col-md-3">
            <cds-actions
              template="/static/templates/cds_deposit/types/project/actions.html"
            >
            </cds-actions>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <cds-form
            template="/static/templates/cds_deposit/types/project/form.html"
            form="{{$ctrl.masterForm}}"
          >
          </cds-form>
          <!-- ADD children -->
          <div id="{{child.metadata._deposit.id}}" ng-repeat="child in $ctrl.children track by $index">
            <cds-deposit
              index="$index + 1"
              id="child.metadata._deposit.id"
              update-record-after-success="true"
              update-record-in-background="10000"
              links="child.links"
              schema="{{ $ctrl.childrenSchema }}"
              record="child.metadata"
              deposit-form-model="$ctrl.depositForms[$index + 1]"
            >
              <div class="panel panel-default">
                <div class="panel-heading">
                  <cds-actions
                    template="/static/templates/cds_deposit/types/video/action_delete.html"
                  >
                  </cds-actions>
                </div>
                <div class="panel-body">
                  <cds-form
                    template="/static/templates/cds_deposit/types/video/form.html"
                    form="{{$ctrl.childrenForm}}"
                  >
                  <cds-uploader
                    files="child.metadata._files"
                    template="/static/templates/cds_deposit/types/common/uploader.html"
                    remote-master-receiver="/api/hooks/receivers/avc/events/"
                  >
                    <cds-remote-uploader
                        template="/static/templates/cds_deposit/remote_upload.html"
                        dropbox-enabled="true"
                        dropbox-selector=".dropbox-upload"
                        dropbox-app-key="{{ dropboxAppKey }}"
                        remote-master-receiver="/api/hooks/receivers/avc/events/"
                        remote-children-receiver="/api/hooks/receivers/downloader/events/"
                    >
                      <div class="dropbox-upload"></div>
                    </cds-remote-uploader>
                  </cds-uploader>
                  </cds-form>
                </div>
              </div>
            </cds-deposit>
          </div>
          <!-- /ADD children -->
          <cds-uploader
            files="$ctrl.master.metadata._files"
            template="/static/templates/cds_deposit/types/common/uploader.html"
          >
            <cds-remote-uploader
                template="/static/templates/cds_deposit/remote_upload.html"
                dropbox-enabled="true"
                dropbox-selector=".dropbox-upload"
                dropbox-app-key="{{ dropboxAppKey }}"
                remote-master-receiver="/api/hooks/receivers/avc/events/"
                remote-children-receiver="/api/hooks/receivers/downloader/events/"
            >
              <div class="dropbox-upload"></div>
            </cds-remote-uploader>
          </cds-uploader>
        </div>
      </div>
    </div>
  </cds-deposit>
</div>
